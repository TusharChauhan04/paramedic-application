<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Management - Air Medical 24x7</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="assets/favicon.png">
</head>

<body>
  <div class="min-h-screen" style="background: rgb(250, 245, 255);">
    <div class="sidebar" style="background: rgb(250, 245, 255);">
      <div class="sidebar-logo"><img src="assets/air-medical-logo.png" alt="Air Medical 24x7"
          onerror="this.style.display='none'"></div>
      <nav class="sidebar-nav">
        <a href="admin-dashboard.html" class="admin-sidebar-link"><svg class="icon" xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24">
            <rect x="3" y="3" width="7" height="7"></rect>
            <rect x="14" y="3" width="7" height="7"></rect>
            <rect x="14" y="14" width="7" height="7"></rect>
            <rect x="3" y="14" width="7" height="7"></rect>
          </svg>Dashboard</a>
        <a href="admin-users.html" class="admin-sidebar-link active"><svg class="icon"
            xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>User Management</a>
        <a href="admin-cases.html" class="admin-sidebar-link"><svg class="icon" xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
          </svg>All Cases</a>
        <a href="leads.html" class="admin-sidebar-link"><svg class="icon" xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24">
            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="8.5" cy="7" r="4"></circle>
            <line x1="20" y1="8" x2="20" y2="14"></line>
            <line x1="23" y1="11" x2="17" y2="11"></line>
          </svg>Leads</a>
        <a href="admin-expenses.html" class="admin-sidebar-link"><svg class="icon" xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24">
            <line x1="12" y1="1" x2="12" y2="23"></line>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
          </svg>Expenses</a>
        <a href="documents.html" class="admin-sidebar-link"><svg class="icon" xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <polyline points="10 9 9 9 8 9"></polyline>
          </svg>Documents</a>
        <a href="admin-locations.html" class="admin-sidebar-link"><svg class="icon" style="width: 1.25rem; height: 1.25rem;" xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
            <circle cx="12" cy="10" r="3"></circle>
          </svg>Locations</a>
        <a href="settings.html" class="admin-sidebar-link"><svg class="icon" xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="3"></circle>
            <path
              d="M12 1v6m0 6v6m5.196-15.804L13.464 7.46m-3.392 9.08-3.732 3.732m15.804-5.195L17.54 13.464m-9.08-3.392-3.732-3.732">
            </path>
          </svg>Settings</a>
      </nav>
    </div>

    <div class="admin-main-content">
      <header class="header" style="background: white; border-bottom-color: rgb(233, 213, 255);">
        <div class="flex-1 flex items-center"><button type="button" id="mobile-menu-btn" class="btn-icon btn-ghost hidden"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <line x1="3" y1="12" x2="21" y2="12"></line>
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg></button></div>
        <div class="header-actions">
          <button class="btn-icon btn-ghost notification-btn"><svg class="icon" xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24">
              <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
              <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg><span class="notification-badge"></span></button>
          <div class="user-dropdown">
            <button id="user-dropdown-btn" class="user-btn">
              <div class="user-avatar" style="background-color: rgb(107, 33, 168);">AU</div><span
                class="hidden md:block text-sm font-medium text-gray-700" id="user-display-name">Admin</span>
            </button>
            <div id="user-dropdown-menu" class="dropdown-menu">
              <div class="dropdown-header">
                <p class="text-sm font-medium">Admin User</p>
                <p class="text-xs text-gray-500">admin@demo.com</p>
              </div>
              <div class="dropdown-divider"></div>
              <a href="#" data-logout class="dropdown-item danger"><svg class="icon-sm"
                  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                  <polyline points="16 17 21 12 16 7"></polyline>
                  <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>Log out</a>
            </div>
          </div>
        </div>
      </header>

      <main class="content-area space-y-6">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
          <div>
            <h1 class="text-3xl font-bold text-gray-900">User Management</h1>
            <p class="text-gray-600 mt-1">Manage paramedic staff accounts</p>
          </div>
          <button class="btn btn-primary" onclick="openAddUserModal()"><svg class="mr-2 h-4 w-4"
              xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>Add New User</button>
        </div>

        <!-- Search Bar -->
        <div class="card" style="border-color: rgb(233, 213, 255);">
          <div class="card-content">
            <div class="relative">
              <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"
                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
              <input type="text" class="input pl-10" placeholder="Search users by name or email..." id="search-input"
                oninput="filterUsers()">
            </div>
          </div>
        </div>

        <!-- Users Table -->
        <div class="card" style="border-color: rgb(233, 213, 255);">
          <div class="card-header">
            <div class="card-title">All Users</div>
            <div class="card-description">Manage staff accounts and permissions</div>
          </div>
          <div class="card-content">
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead>
                  <tr class="border-b border-gray-200">
                    <th class="text-left p-3 text-sm font-medium text-gray-600">User</th>
                    <th class="text-left p-3 text-sm font-medium text-gray-600">Role</th>
                    <th class="text-left p-3 text-sm font-medium text-gray-600">Status</th>
                    <th class="text-left p-3 text-sm font-medium text-gray-600">Joined</th>
                    <th class="text-right p-3 text-sm font-medium text-gray-600">Actions</th>
                  </tr>
                </thead>
                <tbody id="users-table-body"></tbody>
              </table>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Add/Edit User Modal -->
  <div id="user-modal" class="hidden"
    style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); z-index: 9999; overflow-y: auto; padding: 20px;">
    <div class="modal" style="max-width: 500px; margin: 50px auto; position: relative;">
      <div class="modal-header">
        <h3 class="modal-title" id="modal-title">Add New User</h3>
        <button class="modal-close" onclick="Utils.hideModal('user-modal')" type="button">&times;</button>
      </div>
      <form id="user-form">
        <div class="modal-body space-y-4">
          <div class="form-group">
            <label class="label">Full Name *</label>
            <input type="text" class="input" id="user-name" required>
          </div>
          <div class="form-group">
            <label class="label">Email *</label>
            <input type="email" class="input" id="user-email" required>
          </div>
          <div class="form-group">
            <label class="label">Role *</label>
            <select class="input" id="user-role" required>
              <option value="user">Paramedic Staff</option>
              <option value="admin">Administrator</option>
            </select>
          </div>
          <div class="form-group">
            <label class="label">Employee ID *</label>
            <input type="text" class="input" id="user-employee-id" required>
          </div>
          <div class="form-group">
            <label class="label">Status *</label>
            <select class="input" id="user-status" required>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline" onclick="Utils.hideModal('user-modal')">Cancel</button>
          <button type="submit" class="btn btn-primary">Save User</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="delete-modal" class="hidden"
    style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); z-index: 9999; overflow-y: auto; padding: 20px;">
    <div class="modal" style="max-width: 400px; margin: 100px auto; position: relative;">
      <div class="modal-header">
        <h3 class="modal-title">Confirm Deletion</h3>
        <button class="modal-close" onclick="Utils.hideModal('delete-modal')" type="button">&times;</button>
      </div>
      <div class="modal-body">
        <p class="text-gray-600">Are you sure you want to delete this user? This action cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" onclick="Utils.hideModal('delete-modal')">Cancel</button>
        <button type="button" class="btn" style="background-color: rgb(220, 38, 38); color: white;"
          onclick="confirmDelete()">Delete User</button>
      </div>
    </div>
  </div>

  <script src="auth.js"></script>
  <script src="utils.js"></script>
  <script src="app.js"></script>
  <script>
    let users = [];
    let editingUserId = null;
    let deletingUserId = null;

    const defaultUsers = [
      { id: 1, name: 'John Doe', email: 'user@demo.com', role: 'user', employeeId: 'EMP-2024-001', status: 'active', joinedDate: '2024-01-15' },
      { id: 2, name: 'Jane Smith', email: 'jane@demo.com', role: 'user', employeeId: 'EMP-2024-002', status: 'active', joinedDate: '2024-02-01' },
      { id: 3, name: 'Mike Johnson', email: 'mike@demo.com', role: 'user', employeeId: 'EMP-2024-003', status: 'active', joinedDate: '2024-02-15' },
      { id: 4, name: 'Admin User', email: 'admin@demo.com', role: 'admin', employeeId: 'EMP-ADMIN-001', status: 'active', joinedDate: '2024-01-01' },
    ];

    function loadUsers() {
      const saved = Utils.loadFromStorage('adminUsers');
      users = saved && saved.length > 0 ? saved : defaultUsers;
      if (!saved) Utils.saveToStorage('adminUsers', users);
    }

    function renderUsers(filteredUsers = users) {
      const tbody = document.getElementById('users-table-body');

      if (filteredUsers.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-gray-500">No users found</td></tr>';
        return;
      }

      tbody.innerHTML = filteredUsers.map(user => `
        <tr class="border-b border-gray-100 hover:bg-gray-50">
          <td class="p-3">
            <div class="flex items-center gap-3">
              <div class="user-avatar" style="background-color: ${user.role === 'admin' ? 'rgb(107, 33, 168)' : 'rgb(37, 99, 235)'};">${user.name.split(' ').map(n => n[0]).join('')}</div>
              <div>
                <p class="text-sm font-medium text-gray-900">${user.name}</p>
                <p class="text-xs text-gray-500">${user.email}</p>
              </div>
            </div>
          </td>
          <td class="p-3"><span class="badge ${user.role === 'admin' ? 'badge-primary' : 'badge-default'}">${user.role === 'admin' ? 'Administrator' : 'Paramedic'}</span></td>
          <td class="p-3"><span class="badge ${user.status === 'active' ? 'badge-success' : 'badge-default'}">${user.status}</span></td>
          <td class="p-3"><span class="text-sm text-gray-600">${new Date(user.joinedDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</span></td>
          <td class="p-3">
            <div class="flex justify-end gap-2">
              <button class="btn btn-outline btn-sm" onclick="editUser(${user.id})">Edit</button>
              <button class="btn btn-outline btn-sm" style="color: rgb(220, 38, 38); border-color: rgb(220, 38, 38);" onclick="deleteUser(${user.id})">Delete</button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    function filterUsers() {
      const search = document.getElementById('search-input').value.toLowerCase();
      const filtered = users.filter(u =>
        u.name.toLowerCase().includes(search) ||
        u.email.toLowerCase().includes(search)
      );
      renderUsers(filtered);
    }

    function openAddUserModal() {
      editingUserId = null;
      document.getElementById('modal-title').textContent = 'Add New User';
      document.getElementById('user-form').reset();
      Utils.showModal('user-modal');
    }

    function editUser(id) {
      const user = users.find(u => u.id === id);
      if (!user) return;

      editingUserId = id;
      document.getElementById('modal-title').textContent = 'Edit User';
      document.getElementById('user-name').value = user.name;
      document.getElementById('user-email').value = user.email;
      document.getElementById('user-role').value = user.role;
      document.getElementById('user-employee-id').value = user.employeeId;
      document.getElementById('user-status').value = user.status;
      Utils.showModal('user-modal');
    }

    function deleteUser(id) {
      deletingUserId = id;
      Utils.showModal('delete-modal');
    }

    function confirmDelete() {
      users = users.filter(u => u.id !== deletingUserId);
      Utils.saveToStorage('adminUsers', users);
      Utils.hideModal('delete-modal');
      renderUsers();
      Utils.showToast('User deleted successfully', 'success');
    }

    document.getElementById('user-form').addEventListener('submit', (e) => {
      e.preventDefault();

      const userData = {
        name: document.getElementById('user-name').value.trim(),
        email: document.getElementById('user-email').value.trim(),
        role: document.getElementById('user-role').value,
        employeeId: document.getElementById('user-employee-id').value.trim(),
        status: document.getElementById('user-status').value
      };

      if (editingUserId) {
        const index = users.findIndex(u => u.id === editingUserId);
        users[index] = { ...users[index], ...userData };
        Utils.showToast('User updated successfully', 'success');
      } else {
        const newUser = {
          id: Math.max(...users.map(u => u.id), 0) + 1,
          ...userData,
          joinedDate: new Date().toISOString().split('T')[0]
        };
        users.push(newUser);
        Utils.showToast('User added successfully', 'success');
      }

      Utils.saveToStorage('adminUsers', users);
      Utils.hideModal('user-modal');
      renderUsers();
    });

    document.addEventListener('DOMContentLoaded', () => {
      Auth.requireAuth(true);
      loadUsers();
      renderUsers();
    });
  </script>
  <style>
    @media (max-width: 1023px) {
      #mobile-menu-btn {
        display: inline-flex !important;
      }
    }

    table {
      border-collapse: collapse;
    }
  </style>
</body>

</html>